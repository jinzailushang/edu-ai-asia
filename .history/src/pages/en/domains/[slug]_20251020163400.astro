---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import DomainDetail from '../../../components/DomainDetail.astro';
import DomainCard from '../../../components/DomainCard.astro';
import type { Domain } from '../../../types/domain';
import domainsData from '../../../data/domains.json';

export async function getStaticPaths() {
  const domains = domainsData as Domain[];
  return domains.map((domain) => ({
    params: { slug: domain.id },
    props: { domain },
  }));
}

const { domain } = Astro.props;
const locale = 'en';

// Get related domains (same category, excluding current)
const allDomains = domainsData as Domain[];
const relatedDomains = allDomains
  .filter(d => d.category === domain.category && d.id !== domain.id && d.status === 'available')
  .slice(0, 3);

// SEO metadata
const title = `${domain.name} - Premium AI Domain | ${domain.content.en.tagline}`;
const description = domain.content.en.fullDescription.substring(0, 160);
const keywords = [
  domain.name,
  domain.category,
  'AI domain',
  'domain for sale',
  'premium domain',
  ...domain.tags
];
---

<BaseLayout 
  title={title} 
  description={description} 
  locale={locale}
  keywords={keywords}
  type="product"
>
  <DomainDetail domain={domain} locale={locale} />
  
  <!-- Related Domains -->
  {relatedDomains.length > 0 && (
    <section class="py-16 bg-gray-50" aria-labelledby="related-domains-heading">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <header class="text-center mb-12">
          <h2 id="related-domains-heading" class="text-3xl font-bold text-gray-900 mb-4">
            Related Domains
          </h2>
          <p class="text-xl text-gray-600">
            Other premium domains in the {domain.category} category
          </p>
        </header>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" role="list">
          {relatedDomains.map((relatedDomain) => (
            <article role="listitem">
              <DomainCard domain={relatedDomain} locale={locale} />
            </article>
          ))}
        </div>
      </div>
    </section>
  )}
  
  <!-- CTA Section -->
  <section class="py-16 bg-gradient-to-r from-primary to-gradient-end" aria-labelledby="cta-heading">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 id="cta-heading" class="text-3xl sm:text-4xl font-bold text-white mb-4">
        Interested in {domain.name}?
      </h2>
      <p class="text-xl text-blue-100 mb-8">
        Contact us now for detailed pricing and purchase information
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <a 
          href={`tel:${siteConfig.contact.phone}`}
          class="inline-flex items-center px-8 py-4 bg-white text-primary text-lg font-semibold rounded-lg hover:shadow-lg hover:scale-105 transition-all duration-300"
          aria-label="Call now for domain inquiry"
        >
          Call Now
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
        </a>
        <a 
          href="tel:13352963461"
          class="inline-flex items-center px-8 py-4 bg-transparent text-white text-lg font-semibold rounded-lg border-2 border-white hover:bg-white hover:text-primary transition-all duration-300"
          aria-label="Call 13352963461"
        >
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          13352963461
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<!-- Schema.org Structured Data - Product -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Product",
  "name": domain.name,
  "description": domain.content.en.fullDescription,
  "category": domain.category,
  "brand": {
    "@type": "Brand",
    "name": domain.name
  },
  "offers": {
    "@type": "Offer",
    "availability": domain.status === 'available' 
      ? "https://schema.org/InStock" 
      : "https://schema.org/OutOfStock",
    "price": domain.priceRange || "Contact for price",
    "priceCurrency": "USD",
    "seller": {
      "@type": "Organization",
      "name": "edu-ai.asia"
    }
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "reviewCount": "1"
  }
})} />

<!-- Schema.org Structured Data - BreadcrumbList -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": new URL('/en', Astro.site || 'https://edu-ai.asia').toString()
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Domains",
      "item": new URL('/en', Astro.site || 'https://edu-ai.asia').toString()
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": domain.name,
      "item": new URL(`/en/domains/${domain.id}`, Astro.site || 'https://edu-ai.asia').toString()
    }
  ]
})} />
